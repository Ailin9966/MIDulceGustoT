<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Formulario de Pedido</title>
  <link rel="stylesheet" href="formulario1.css" />
</head>
<body>

  <div class="formulario-contenedor">
    <h1>Reg√≠strate y Env√≠a tu Pedido</h1>
    <form action="procesar.php" method="POST">
      <label for="nombre">Nombre:</label>
      <input type="text" name="nombre" id="nombre" required />

      <label for="correo">Correo electr√≥nico:</label>
      <input type="email" name="correo" id="correo" required />

      <label for="fecha">¬øPara cu√°ndo quieres tu pedido?</label>
      <input type="date" name="fecha" id="fecha" required />

      <label for="pedido">Tu pedido:</label>
      <textarea name="pedido" id="pedido" rows="6" readonly required></textarea>

      <button type="submit">Enviar Pedido</button>
    </form>
  </div>
<div class="contenedor-boton">
  <a href="index.html" class="boton-regresar">üå∏ P√°gina Inicio</a>
</div>

 <div class="botones-carrito">
      <button class="boton-pagar" onclick="enviarPedido()">Encargar üí≥</button>
    </div>
  </main>

  
  <script>
    let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
    const contenedor = document.getElementById("productos-carrito");
    const totalSpan = document.getElementById("total");

    function mostrarCarrito() {
      contenedor.innerHTML = '';
      let total = 0;

      if (carrito.length === 0) {
        contenedor.innerHTML = '<p class="vac√≠o">Tu carrito est√° vac√≠o.</p>';
        totalSpan.textContent = '0.00';
        return;
      }

      carrito.forEach((producto, index) => {
        const div = document.createElement("div");
        div.className = "producto-carrito";
        div.innerHTML = `
          <img src="${producto.imagen}" alt="${producto.nombre}" class="img-carrito">
          <div>
            <h3>${producto.nombre}</h3>
            <p>Precio: $${producto.precio.toFixed(2)} MXN</p>
            <button class="btn-eliminar" onclick="eliminarProducto(${index})">Eliminar</button>
          </div>
        `;
        contenedor.appendChild(div);
        total += producto.precio;
      });

      totalSpan.textContent = total.toFixed(2);
    }

    function eliminarProducto(index) {
      carrito.splice(index, 1);
      localStorage.setItem("carrito", JSON.stringify(carrito));
      mostrarCarrito();
    }

    function enviarPedido() {
      if (carrito.length === 0) {
        alert("Tu carrito est√° vac√≠o, no hay nada que pagar.");
        return;
      }

      let productosTexto = carrito.map(p => `${p.nombre} - $${p.precio}`).join("\n");
      let total = carrito.reduce((acc, p) => acc + p.precio, 0).toFixed(2);

      const templateParams = {
        to_name: "Capricho",
        message: `Nuevo pedido:\n\n${productosTexto}\n\nTotal: $${total} MXN`,
        reply_to: "ailinriveraflores@gmail.com"
      };

      emailjs.send('service_gtzc1jr', 'template_cazd92d', templateParams)
        .then(function(response) {
           alert('‚úÖ Pedido enviado correctamente.');
           localStorage.removeItem('carrito');
           window.location.href = "inicio.html";
        }, function(error) {
           alert('‚ùå Error al enviar pedido: ' + JSON.stringify(error));
        });
    }

    window.onload = mostrarCarrito;
  </script>

</body>
</html>

